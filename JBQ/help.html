<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>amf的主页 - JBQ开发帮助</title>
        <link rel="icon" type="image/x-icon" href="/static/img/JBQ.ico">
        <link rel="stylesheet" type="text/css" href="/static/css/base.css">
        <link rel="stylesheet" type="text/css" href="/static/css/JBQ/help.css">
    </head>
    <body>
        <header>
            <h1>amf的主页</h1>
            <nav>
                <a href="/">主页</a>
                <a href="/JBQ/">精班棋</a>
                <a href="https://github.com/amf14151" target="_blank">个人简介</a>
            </nav>
        </header>
        <main>
            <h2>精班棋开发帮助</h2>
            <section>
                <p>本帮助介绍了自定义地图以及编写扩展的方法，若要查看游戏帮助内容请前往<a href="https://github.com/amf14151/s27a_jbq/blob/main/README.md">这里</a></p>
            </section>
            <h3>自定义地图</h3>
            <section class="help-text">
                <p>地图文件是<code>.xlsx</code>文件，其中必须包含3个表，分别对应棋子、棋盘与特殊规则</p>
                <p>示例地图文件请从<em>地图文件包</em>中获取</p>
                <h4>棋盘构造</h4>
                <p>棋盘的每个位置都有对应的行数、列数。行数为x，列数为y，分别自左上至右下<strong>由1递增</strong>，自右下至左上<strong>由-1递减</strong></p>
                <table>
                    <caption>棋盘构造演示</caption>
                    <tbody>
                        <tr>
                            <td></td>
                            <th>y=1</th>
                            <th>y=2</th>
                            <th>y=3</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th>x=1</th>
                            <td>格</td>
                            <td>格</td>
                            <td>格</td>
                            <th>x=-2</th>
                        </tr>
                        <tr>
                            <th>x=2</th>
                            <td>格</td>
                            <td>格</td>
                            <td>格</td>
                            <th>x=-1</th>
                        </tr>
                        <tr>
                            <td></td>
                            <th>y=-3</th>
                            <th>y=-2</th>
                            <th>y=-1</th>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <p>在填写棋子位置时<strong>均以红方棋盘为正向</strong></p>
                <h4>棋子表</h4>
                <p>棋子表的名称为<em>chesses</em></p>
                <p>棋子表定义了地图中各个棋子的名称等基本信息，这些信息会按照一定的语法规则进行编写，并填入固定的位置中</p>
                <p>下面是棋子表中使用的语法规则</p>
                <ol>
                    <li>棋子位置规则
                        <p>棋子位置规则返回值为<code>true</code>或<code>false</code>，其具体返回值与棋子位置规则所属于的棋子的位置有关</p>
                        <p>单个棋子位置规则表示为<code>M[arg1|arg2|...]</code>的形式，其中<code>M</code>为规则名，<code>arg1</code>、<code>arg2</code>等为参数。参数<strong>只能为整数</strong>，参数间用<code>|</code>隔开</p>
                        <p>多个棋子位置规则间用<code>&</code>连接。这些被连接的规则中<strong>只要有一项</strong>返回值为<code>true</code>，则该整体规则返回值为<code>true</code></p>
                        <p>可使用的规则名
                            <ul>
                                <li><code>X[arg1|arg2|...]</code>：当棋子所在的行数为任意一个参数时，该规则的返回值为<code>true</code>，否则为<code>false</code></p>
                                <li><code>Y[arg1|arg2|...]</code>：当棋子所在的列数为任意一个参数时，该规则的返回值为<code>true</code>，否则为<code>false</code></p>
                                <li><code>P[x1|y1|x2|y2|...]</code>：当棋子所在的位置为任意<code>(xn,yn)</code>时，该规则的返回值为<code>true</code>，否则为<code>false</code></p>
                            </ul>
                        </p>
                        <p>未被定义的规则名返回值为<code>false</code></p>
                        <p>棋子位置规则示例：<code>X[1|-1]&Y[1|-1]</code>当棋子位于棋盘边缘区域时返回<code>true</code></p>
                    </li>
                    <li>可移动规则
                        <p>可移动规则定义了棋子可以移动到的位置，由多项构成。项与项间由<code>;</code>分割，每项的语法相同</p>
                        <p>默认的可移动规则有两项，第一项为可以向某方向移动一格，第二项为可以向某方向移动无限格</p>
                        <p>棋子的可移动方向有8个，这些方向按<em>左上、上、右上、左、右、左下、下、右下</em>分别对应1~8</p>
                        <p>在每一项中，用<code>,</code>分隔开所有可移动方向编号。如果在这一方向上是否可以移动有棋子位置限制，可以在方向编号后加上<code>()</code>，并在内部填入<em>棋子位置规则</em></p>
                        <p>如果棋子没有前一项规则，但有后一项，也需要使用<code>;</code>占位。棋子可移动规则<strong>至少需要前两项</strong>，否则将会报错</p>
                        <p>可移动规则示例：<code>2,4,5,7;2(X[-1])</code>表示棋子的走法为十字形，而当棋子位于底线时可以向前无限格</p>
                    </li>
                </ol>
                <p>棋子表表格中第一行为表头，自第二行起每行定义一种棋子（注意：双方棋子需要分别定义）</p>
                <table>
                    <caption>表头格式</caption>
                    <tbody>
                        <tr>
                            <th>编号</th>
                            <th>名称</th>
                            <th>归属</th>
                            <th>首领</th>
                            <th>可移动</th>
                            <th>升变条件</th>
                            <th>升变后可移动</th>
                            <th>...</th>
                        </tr>
                    </tbody>
                </table>
                <p>表头每一列的<strong>顺序是固定的</strong>，具体填写语法如下</p>
                <ul>
                    <li>编号
                        <p>每种棋子独立的编号</p>
                        <p>按照自上至下的顺序由1递增</p>
                    </li>
                    <li>名称
                        <p>棋子在窗口中显示出的字符串</p>
                        <p>可以重复，长度尽量小于等于3，当名称为纯数字时需用双引号<code>"</code>包裹</p>
                    </li>
                    <li>归属
                        <p>红方棋子归属为1，蓝方棋子归属为2，中立棋子（双方都可以移动，但既不能吃子也不能被吃）归属为3</p>
                    </li>
                    <li>首领
                        <p>默认值为空，如果该棋子是首领则需要填入<code>c</code></p>
                        <p>首领数量不限，任意首领被吃即会结束游戏</p>
                    </li>
                    <li>可移动
                        <p>填入<em>可移动规则</em>，为棋子在未升变（见下文）时的可移动规则</p>
                        <p>注意蓝方棋子的可移动规则与棋盘正向相反</p>
                    </li>
                    <li>升变条件
                        <p>填入<em>棋子位置规则</em>，默认值为空，即不启用升变</p>
                        <p>当棋子位置符合升变条件时，其可移动规则永久变为<em>升变后可移动</em></p>
                    </li>
                    <li>升变后可移动
                        <p>填入<em>可移动规则</em></p>
                        <p>注意：该角色无法升变时仍需填写<code>;</code></p>
                    </li>
                    <li>其他
                        <p>可以有多列，具体规则由扩展而定（见<em>编写扩展</em>）</p>
                    </li>
                </ul>
                <h4>棋盘表</h4>
                <p>棋盘表的名称为<em>map</em></p>
                <p>棋盘表定义了棋盘的初始棋子及其位置，由两部分组成：棋盘行列数、棋盘布局</p>
                <p>棋盘行列数在表的第一行，格式如下</p>
                <table>
                    <tr>
                        <th>行</th>
                        <th>[棋盘行数]</th>
                        <th>列</th>
                        <th>[棋盘列数]</th>
                    </tr>
                </table>
                <p>棋盘布局自第二行起，按照表格样式进行填写。每格填写对应棋子编号，空位不填</p>
                <h4>特殊规则表</h4>
                <p>特殊规则表为提前预定格式（见示例地图），每项特殊规则默认不启用，如果启用则需填入<code>c</code></p>
                <p>特殊规则介绍</p>
                <ul>
                    <li>启用升变：一些棋子在达成某些条件后会升变，获得更强的移动方式</li>
                    <li>启用悔棋：在对方走出下一步前可以悔棋（仅限单人模式）</li>
                    <li>限制连续3步以上移动中立棋子：一方连续移动中立棋子的步数达到3次时本回合将不能继续移动中立棋子，该规则对于所有中立棋子通用</li>
                </ul>
            </section>
            <h3>编写扩展</h3>
            <section class="help-text">
                <p>扩展文件是<code>.py</code>文件</p>
                <p>扩展文件中需要定义一些特定的函数或方法，这些函数或方法将会在游戏中的某一指定时刻进行调用以改变游戏状态</p>
                <h4>数据类型</h4>
                <p>扩展文件函数或方法的参数中除基本数据类型外，还会有以下的特殊数据类型</p>
                <ul>
                    <li><code>tuple[int,int]</code>位置二元组
                        <p>表示棋子位置。其中第一项为行数，第二项为列数</p>
                        <p>该棋子位置自左上至右下<strong>由0递增</strong>，自右下至左上<strong>由-1递减</strong>（与Python列表等同）</p>
                    </li>
                    <li><code>class Chess</code>棋子类
                        <ul>
                            <li><code>id</code>
                                <p>棋子编号</p>
                            </li>
                            <li><code>name</code>
                                <p>棋子名称</p>
                            </li>
                            <li><code>belong</code>
                                <p>棋子归属</p>
                            </li>
                            <li><code>is_captain</code>
                                <p>棋子是否为首领</p>
                            </li>
                            <li><code>is_tran</code>
                                <p>棋子是否已升变</p>
                            </li>
                        </ul>
                    </li>
                </ul>
                <h4>扩展接口</h4>
                <p>扩展接口类名称为<code>JBQ</code>，其中内置了各种扩展接口，可以在扩展文件全局被调用</p>
                <p>变量</p>
                <ul>
                    <li><code>JBQ.rl</code>棋盘总行数</li>
                    <li><code>JBQ.cl</code>棋盘总列数</li>
                    <li><code>JBQ.turn</code>当前游戏回合
                        <p>整数。1为红方回合，2为蓝方回合</p>
                    </li>
                </ul>
                <p>函数</p>
                <ul>
                    <li><code>JBQ.get_arr_by_rd(arr:tuple[int,int],r:int,d:int)</code>
                        <p>根据相对于某一特定位置的距离和方向获取一个新的目标位置</p>
                        <p><code>arr</code>为起始位置；<code>r</code>为相对于起始位置的方向，取值范围为1~8（见<em>自定义地图</em>）；<code>d</code>为距离</p>
                        <p>若目标位置在棋盘范围内，则返回其<em>位置二元组</em>，否则返回<code>None</code></p>
                    </li>
                    <li><code>JBQ.get_chess_by_arr(arr:tuple[int,int])</code>
                        <p>若<code>arr</code>处有棋子，则返回<code>Chess</code>对象，否则返回<code>None</code></p>
                    </li>
                    <li><code>JBQ.get_chess_arr_by_id(id:int)</code>
                        <p>若棋盘中只有一个编号为<code>id</code>的棋子，则返回其<em>位置二元组</em>，否则返回<code>None</code></p>
                    </li>
                    <li><code>JBQ.can_eat(chess1:Chess,chess2:Chess)</code>
                        <p>若<code>chess1</code>与<code>chess2</code>分属不同阵营且都不为第三方棋子时返回<code>True</code>，否则返回<code>False</code></p>
                    </li>
                    <li><code>JBQ.add_chess(id:int,arr:tuple[int,int])</code>
                        <p>在<code>arr</code>处添加编号为<code>id</code>的棋子</p>
                    </li>
                    <li><code>JBQ.move(arr1:tuple[int,int],arr2:tuple[int,int])</code>
                        <p>将<code>arr1</code>处的棋子移动至<code>arr2</code>，该移动不会调用<em>after_move</em>（见后文）</p>
                    </li>
                    <li><code>JBQ.win(belong:int)</code>
                        <p>将<code>belong</code>一方设为胜利方并结束游戏</p>
                    </li>
                    <li><code>JBQ.stalemate()</code>
                        <p>和棋并结束游戏</p>
                    </li>
                </ul>
                <h4>文件构造</h4>
                <p>扩展文件需有以下常量</p>
                <ul>
                    <li><code>EX_NAME</code>：字符串，内容为扩展名称</li>
                    <li><code>EX_VERSION</code>：字符串，内容为扩展版本</li>
                </ul>
                <p>扩展文件可以定义以下函数或方法（非必须）</p>
                <ul>
                    <li><code>loc_rules</code>
                        <p>用于自定义<em>棋盘位置规则</em></p>
                        <p>字典。键为字符串，其内容为棋盘位置规则名称；值为函数，内容为对应的棋盘位置规则函数（函数内容见下）</p>
                        <p><code>loc_func(args:tuple[int],arr:tuple[int,int])</code></p>
                        <p><code>args</code>为<em>棋盘位置规则</em>中传入的参数，在地图中定义；<code>arr</code>为该棋子此时所处的位置</p>
                        <p>返回值为<code>bool</code>值，取决于该规则是否被满足</p>
                        <p>注：函数名称任意</p>
                    </li>
                    <li><code>check_can_go(can_go:list[list[tuple[int,int]]],chess:Chess,arr:tuple[int,int])</code>
                        <p>在获取棋子可移动位置时触发，修改该棋子的可移动位置</p>
                        <p><code>can_go</code>中每一项表示一个可行走组（如可行走无限格中的一列），项中的二元组表示可移动到的位置；<code>chess</code>为棋子本身</p>
                        <p>返回值为新的棋子可移动位置</p>
                    </li>
                    <li><code>after_move(arr1:tuple[int,int],arr2:tuple[int,int])</code>
                        <p>在行走后触发</p>
                        <p><code>arr1</code>表示移动前位置；<code>arr2</code>表示该棋子移动后位置</p>
                    </li>
                </ul>
            </section>
        </main>
        <footer>
            <p>© 2023 amf</p>
        </footer>
    </body>
</html>